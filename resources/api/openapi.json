{"openapi":"3.1.0","info":{"title":"AquaAI - API de Predicción de Embalses","description":"API REST para predicción de niveles de embalses usando LSTM Seq2Seq con datos meteorológicos AEMET","version":"1.0.0"},"paths":{"/api/recomendaciones/{codigo_saih}":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Obtener recomendación operativa para un embalse","description":"Genera o recupera la recomendación operativa más reciente para un embalse específico.\n    \n    **Comportamiento:**\n    - Si existe una recomendación generada en las últimas 6 horas con los mismos parámetros, la devuelve.\n    - Si no existe o `forzar_regeneracion=True`, genera una nueva predicción y recomendación.\n    \n    **Parámetros de simulación:**\n    - `fecha_inicio`: Permite simular recomendaciones para cualquier fecha histórica. Si no se proporciona, usa la fecha actual.\n    - `horizonte_dias`: Número de días a predecir desde la fecha de inicio.\n    \n    **Clasificación de riesgo:**\n    - **ALTO**: Nivel predicho ≥ 95% de capacidad máxima (umbral configurable)\n    - **MODERADO**: Nivel predicho entre 80% y 95% de capacidad\n    - **BAJO**: Nivel predicho entre 30% y 80% de capacidad\n    - **SEQUÍA**: Nivel predicho ≤ 30% de capacidad\n    \n    Los umbrales son configurables por embalse o se usan valores globales por defecto.","operationId":"obtener_recomendacion_embalse_api_recomendaciones__codigo_saih__get","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","description":"Código SAIH del embalse (ej: E001)","title":"Codigo Saih"},"description":"Código SAIH del embalse (ej: E001)"},{"name":"fecha_inicio","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Fecha de inicio para simulación (YYYY-MM-DD). Si no se especifica, usa la fecha actual del sistema.","title":"Fecha Inicio"},"description":"Fecha de inicio para simulación (YYYY-MM-DD). Si no se especifica, usa la fecha actual del sistema."},{"name":"horizonte_dias","in":"query","required":false,"schema":{"anyOf":[{"type":"integer","maximum":180,"minimum":1},{"type":"null"}],"description":"Horizonte de predicción en días. Si es None, usa la configuración del embalse (defecto: 7).","title":"Horizonte Dias"},"description":"Horizonte de predicción en días. Si es None, usa la configuración del embalse (defecto: 7)."},{"name":"forzar_regeneracion","in":"query","required":false,"schema":{"type":"boolean","description":"Si True, regenera la recomendación aunque exista una reciente en caché.","default":false,"title":"Forzar Regeneracion"},"description":"Si True, regenera la recomendación aunque exista una reciente en caché."},{"name":"esperar_ia","in":"query","required":false,"schema":{"type":"boolean","description":"Si True y la IA está habilitada, espera a que se genere la recomendación con IA antes de responder.","default":false,"title":"Esperar Ia"},"description":"Si True y la IA está habilitada, espera a que se genere la recomendación con IA antes de responder."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecomendacionOperativaDTO"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["Recomendaciones Operativas"],"summary":"Generar nueva recomendación (forzada)","description":"Genera una nueva recomendación para el embalse, independientemente de si existe una reciente.\n    \n    **Uso en simulaciones:**\n    Este endpoint es ideal para dashboards interactivos donde el usuario puede:\n    - Navegar por diferentes fechas históricas\n    - Simular escenarios futuros\n    - Comparar predicciones con datos reales\n    \n    **Body (JSON):**\n    - `fecha_inicio`: Fecha para la simulación (opcional, usa hoy si no se especifica)\n    - `horizonte_dias`: Número de días a predecir (opcional, usa config del embalse)","operationId":"generar_recomendacion_embalse_api_recomendaciones__codigo_saih__post","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","description":"Código SAIH del embalse","title":"Codigo Saih"},"description":"Código SAIH del embalse"}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecomendacionRequest","default":{"forzar_regeneracion":false}}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecomendacionOperativaDTO"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recomendaciones/{codigo_saih}/historico":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Obtener histórico de recomendaciones","description":"Obtiene el histórico completo de recomendaciones generadas para un embalse.","operationId":"obtener_historico_recomendaciones_api_recomendaciones__codigo_saih__historico_get","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","description":"Código SAIH del embalse","title":"Codigo Saih"},"description":"Código SAIH del embalse"},{"name":"limite","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"description":"Número máximo de recomendaciones a retornar","default":30,"title":"Limite"},"description":"Número máximo de recomendaciones a retornar"},{"name":"nivel_riesgo","in":"query","required":false,"schema":{"anyOf":[{"$ref":"#/components/schemas/NivelRiesgo"},{"type":"null"}],"description":"Filtrar por nivel de riesgo","title":"Nivel Riesgo"},"description":"Filtrar por nivel de riesgo"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListaRecomendacionesResponse"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recomendaciones/demarcacion/{id_demarcacion}":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Resumen de riesgos por demarcación","description":"Obtiene un resumen agregado de los niveles de riesgo de todos los embalses\n    en una demarcación hidrográfica específica.\n    \n    Incluye:\n    - Contadores por nivel de riesgo\n    - Porcentaje de embalses críticos\n    - Listado detallado de embalses en situación crítica (ALTO o SEQUÍA)","operationId":"obtener_riesgos_demarcacion_api_recomendaciones_demarcacion__id_demarcacion__get","parameters":[{"name":"id_demarcacion","in":"path","required":true,"schema":{"type":"string","description":"Código de demarcación (ej: ES090)","title":"Id Demarcacion"},"description":"Código de demarcación (ej: ES090)"},{"name":"solo_criticas","in":"query","required":false,"schema":{"type":"boolean","description":"Si True, solo incluye embalses críticos en el detalle","default":false,"title":"Solo Criticas"},"description":"Si True, solo incluye embalses críticos en el detalle"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RiesgoDemarcacionDTO"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recomendaciones/organismo/{id_organismo}":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Resumen de riesgos por organismo gestor","description":"Obtiene un resumen agregado de los niveles de riesgo de todos los embalses\n    gestionados por un organismo específico (Confederación o Administración Autonómica).\n    \n    Incluye:\n    - Estadísticas globales del organismo\n    - Desglose por demarcaciones gestionadas\n    - Identificación de embalses críticos","operationId":"obtener_riesgos_organismo_api_recomendaciones_organismo__id_organismo__get","parameters":[{"name":"id_organismo","in":"path","required":true,"schema":{"type":"integer","description":"ID del organismo gestor","title":"Id Organismo"},"description":"ID del organismo gestor"},{"name":"incluir_demarcaciones","in":"query","required":false,"schema":{"type":"boolean","description":"Incluir desglose por demarcaciones","default":true,"title":"Incluir Demarcaciones"},"description":"Incluir desglose por demarcaciones"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RiesgoOrganismoDTO"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recomendaciones/resumen/todas":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Resumen de todas las recomendaciones actuales","description":"Obtiene un listado resumido de las últimas recomendaciones para todos los embalses.","operationId":"obtener_todas_recomendaciones_api_recomendaciones_resumen_todas_get","parameters":[{"name":"nivel_riesgo","in":"query","required":false,"schema":{"anyOf":[{"$ref":"#/components/schemas/NivelRiesgo"},{"type":"null"}],"description":"Filtrar por nivel de riesgo","title":"Nivel Riesgo"},"description":"Filtrar por nivel de riesgo"},{"name":"limite","in":"query","required":false,"schema":{"type":"integer","maximum":500,"minimum":1,"description":"Número máximo de resultados","default":100,"title":"Limite"},"description":"Número máximo de resultados"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/RecomendacionResumen"},"title":"Response Obtener Todas Recomendaciones Api Recomendaciones Resumen Todas Get"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recomendaciones/config/{codigo_saih}":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Obtener configuración de umbrales","description":"Obtiene la configuración de umbrales efectiva para un embalse (específica o global).","operationId":"obtener_configuracion_api_recomendaciones_config__codigo_saih__get","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","description":"Código SAIH del embalse","title":"Codigo Saih"},"description":"Código SAIH del embalse"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecomendacionConfigResponse"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recomendaciones/config":{"post":{"tags":["Recomendaciones Operativas"],"summary":"Crear o actualizar configuración de umbrales","description":"Crea o actualiza la configuración de umbrales para un embalse específico o global.\n    \n    **Parámetros clave:**\n    - `codigo_saih`: NULL para configuración global, código específico para un embalse\n    - `umbral_alto_relativo`: % de capacidad para riesgo ALTO (ej: 0.95 = 95%)\n    - `umbral_moderado_relativo`: % de capacidad para riesgo MODERADO (ej: 0.80)\n    - `umbral_minimo_relativo`: % bajo el cual se considera SEQUÍA (ej: 0.30)\n    - `k_sigma`: Multiplicador para intervalo de confianza (nivel ± k*MAE)","operationId":"crear_actualizar_configuracion_api_recomendaciones_config_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecomendacionConfigCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecomendacionConfigResponse"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recomendaciones/config/{config_id}":{"delete":{"tags":["Recomendaciones Operativas"],"summary":"Desactivar configuración","description":"Desactiva una configuración de umbrales específica.","operationId":"desactivar_configuracion_api_recomendaciones_config__config_id__delete","parameters":[{"name":"config_id","in":"path","required":true,"schema":{"type":"integer","description":"ID de la configuración","title":"Config Id"},"description":"ID de la configuración"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/recomendaciones/estadisticas/sistema":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Estadísticas del sistema de recomendaciones","description":"Obtiene estadísticas globales del sistema de recomendaciones.","operationId":"obtener_estadisticas_sistema_api_recomendaciones_estadisticas_sistema_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EstadisticasRecomendaciones"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"}}}},"/api/recomendaciones/tipos-riesgo":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Listar tipos de riesgo disponibles","description":"Obtiene el catálogo de tipos de riesgo con sus descripciones.","operationId":"listar_tipos_riesgo_api_recomendaciones_tipos_riesgo_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"}}}},"/api/recomendaciones/llm/salud":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Verificar estado del servicio LLM (Ollama)","description":"Verifica que el servicio Ollama esté disponible y el modelo configurado esté cargado.\n    \n    **Retorna:**\n    - `disponible`: Si Ollama está accesible\n    - `modelo_configurado`: Nombre del modelo configurado\n    - `modelo_disponible`: Si el modelo está instalado\n    - `modelos_instalados`: Lista de modelos disponibles","operationId":"verificar_salud_llm_api_recomendaciones_llm_salud_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"}}}},"/api/recomendaciones/llm/estadisticas":{"get":{"tags":["Recomendaciones Operativas"],"summary":"Obtener estadísticas de uso del LLM","description":"Muestra estadísticas sobre el uso del servicio LLM:\n    - Total de peticiones\n    - Cache hits/misses\n    - Tasa de éxito del LLM\n    - Errores","operationId":"obtener_estadisticas_llm_api_recomendaciones_llm_estadisticas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"}}}},"/api/recomendaciones/llm/limpiar-cache":{"post":{"tags":["Recomendaciones Operativas"],"summary":"Limpiar caché antiguo del LLM","description":"Elimina entradas antiguas del caché de respuestas LLM.\n    \n    **Parámetro:**\n    - `dias_antiguedad`: Eliminar entradas más antiguas que estos días (default: 30)","operationId":"limpiar_cache_llm_api_recomendaciones_llm_limpiar_cache_post","parameters":[{"name":"dias_antiguedad","in":"query","required":false,"schema":{"type":"integer","maximum":365,"minimum":1,"description":"Días de antigüedad para limpiar","default":30,"title":"Dias Antiguedad"},"description":"Días de antigüedad para limpiar"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/dashboard/kpis":{"get":{"tags":["Dashboard"],"summary":"Obtener KPIs agregados del sistema","description":"Devuelve indicadores clave de rendimiento (KPIs) del sistema de embalses.","operationId":"obtener_kpis_dashboard_api_dashboard_kpis_get","parameters":[{"name":"fecha_referencia","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Fecha de referencia para simular dashboard (YYYY-MM-DD)","title":"Fecha Referencia"},"description":"Fecha de referencia para simular dashboard (YYYY-MM-DD)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DashboardKPIs"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/dashboard/embalses/{codigo_saih}/actual":{"get":{"tags":["Dashboard"],"summary":"Obtener datos actuales de un embalse","description":"Devuelve los datos actuales de un embalse para una fecha de referencia específica.\n    \n    **Datos incluidos:**\n    - Información básica del embalse\n    - Nivel actual\n    - Porcentaje de llenado\n    - Datos meteorológicos recientes\n    - Estadísticas de los últimos 30 días\n    \n    **Simulación temporal:**\n    Si se proporciona `fecha_referencia`, devuelve los datos como si estuvieras en esa fecha.\n    Esto permite simular el dashboard en cualquier momento histórico.","operationId":"obtener_datos_actuales_embalse_api_dashboard_embalses__codigo_saih__actual_get","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","title":"Codigo Saih"}},{"name":"fecha_referencia","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Fecha de referencia para simular dashboard (YYYY-MM-DD)","title":"Fecha Referencia"},"description":"Fecha de referencia para simular dashboard (YYYY-MM-DD)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmbalseActual"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/dashboard/alertas":{"get":{"tags":["Dashboard"],"summary":"Obtener alertas activas del sistema","description":"Devuelve las alertas activas del sistema de embalses.\n    \n    **Tipos de alertas:**\n    - **NIVEL_BAJO**: Embalse por debajo del 30% de capacidad\n    - **NIVEL_CRITICO_BAJO**: Embalse por debajo del 20% de capacidad\n    - **NIVEL_ALTO**: Embalse por encima del 80% de capacidad\n    - **NIVEL_CRITICO_ALTO**: Embalse por encima del 95% de capacidad\n    - **PREDICCION_RIESGO**: Predicción indica riesgo en los próximos días\n    \n    **Filtros disponibles:**\n    - Por severidad (info, warning, error, critical)\n    - Por tipo de alerta\n    - Por demarcación","operationId":"obtener_alertas_api_dashboard_alertas_get","parameters":[{"name":"fecha_referencia","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Fecha de referencia para alertas (YYYY-MM-DD)","title":"Fecha Referencia"},"description":"Fecha de referencia para alertas (YYYY-MM-DD)"},{"name":"severidad","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por severidad: info, warning, error, critical","title":"Severidad"},"description":"Filtrar por severidad: info, warning, error, critical"},{"name":"tipo","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por tipo de alerta","title":"Tipo"},"description":"Filtrar por tipo de alerta"},{"name":"demarcacion","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por demarcación hidrográfica","title":"Demarcacion"},"description":"Filtrar por demarcación hidrográfica"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AlertasResponse"}}}},"404":{"description":"Recurso no encontrado"},"500":{"description":"Error interno del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/informes/generar":{"post":{"tags":["Informes"],"summary":"Generar informe de predicción","description":"Genera un informe completo en PDF y HTML con las predicciones y recomendaciones\n    para un embalse específico.\n    \n    **Tipos de informe:**\n    - **DIARIO**: Informe operativo del día con análisis de situación actual y próximas 24-48h\n    - **SEMANAL**: Informe estratégico con evolución de la última semana y predicciones a 30/90/180 días\n    \n    **Características:**\n    - Diseño profesional sin elementos decorativos\n    - Análisis técnico de tendencias y riesgos\n    - Conclusiones basadas en datos cuantitativos\n    - Recomendaciones operativas accionables\n    - Evaluación de escenarios y riesgos\n    - Métricas de calidad del modelo predictivo\n    \n    **Secciones del informe DIARIO:**\n    1. Resumen ejecutivo\n    2. Estado operacional actual\n    3. Análisis y predicción (24-48h)\n    4. Evaluación de riesgos\n    5. Recomendaciones operativas\n    6. Fiabilidad de predicciones\n    7. Información del documento\n    \n    **Secciones del informe SEMANAL:**\n    1. Resumen ejecutivo\n    2. Evolución durante la semana\n    3. Estado operacional actual\n    4. Predicción y análisis de escenarios\n    5. Evaluación de riesgos\n    6. Recomendaciones estratégicas\n    7. Calidad y confiabilidad del modelo\n    8. Metadatos y trazabilidad\n    \n    **Formatos generados:**\n    - HTML: Para previsualización en navegador\n    - PDF: Para descarga y distribución (requiere WeasyPrint)","operationId":"generar_informe_api_informes_generar_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InformeRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InformeResponse"}}}},"404":{"description":"Informe no encontrado"},"500":{"description":"Error generando informe"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/informes/preview/{informe_id}":{"get":{"tags":["Informes"],"summary":"Previsualizar informe HTML","description":"Muestra el informe generado en formato HTML para previsualización en el navegador.","operationId":"preview_informe_api_informes_preview__informe_id__get","parameters":[{"name":"informe_id","in":"path","required":true,"schema":{"type":"string","title":"Informe Id"}}],"responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}},"404":{"description":"Informe no encontrado"},"500":{"description":"Error generando informe"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/informes/download/{informe_id}":{"get":{"tags":["Informes"],"summary":"Descargar informe PDF","description":"Descarga el informe en formato PDF.","operationId":"download_informe_api_informes_download__informe_id__get","parameters":[{"name":"informe_id","in":"path","required":true,"schema":{"type":"string","title":"Informe Id"}}],"responses":{"200":{"description":"Successful Response"},"404":{"description":"Informe no encontrado"},"500":{"description":"Error generando informe"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/informes/listar":{"get":{"tags":["Informes"],"summary":"Listar informes generados","description":"Lista todos los informes generados, opcionalmente filtrados por embalse.","operationId":"listar_informes_api_informes_listar_get","parameters":[{"name":"embalse_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Embalse Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Informe no encontrado"},"500":{"description":"Error generando informe"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/informes/{informe_id}":{"delete":{"tags":["Informes"],"summary":"Eliminar informe","description":"Elimina un informe y todos sus archivos asociados (HTML, PDF, metadata).","operationId":"eliminar_informe_api_informes__informe_id__delete","parameters":[{"name":"informe_id","in":"path","required":true,"schema":{"type":"string","title":"Informe Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Informe no encontrado"},"500":{"description":"Error generando informe"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/evaluaciones":{"post":{"tags":["Evaluaciones"],"summary":"Registrar evaluación del sistema","description":"Registra una nueva evaluación del sistema AquaIA.\n    \n    **Perfiles disponibles:**\n    - `tecnico`: Para ingenieros y analistas que usan el sistema diariamente\n    - `gestion`: Para responsables de cuenca y toma de decisiones estratégicas\n    \n    **Preguntas por perfil:**\n    \n    **Perfil Técnico:**\n    - `viz_claridad`: Claridad en la distinción visual entre histórico y predicción\n    - `viz_incertidumbre`: Visualización de intervalos de confianza\n    - `inter_zoom`: Fluidez de herramientas de zoom y selección temporal\n    - `inter_navegacion`: Intuitividad en el acceso a detalles de embalses\n    - `metricas_utilidad`: Utilidad de métricas de error (MAE, RMSE)\n    - `metricas_suficiencia`: Suficiencia de métricas presentadas\n    \n    **Perfil Gestión:**\n    - `lenguaje_claridad`: Claridad del lenguaje en recomendaciones\n    - `lenguaje_profesionalidad`: Profesionalidad del lenguaje usado\n    - `riesgos_utilidad`: Utilidad del sistema de clasificación de riesgos\n    - `riesgos_priorizacion`: Efectividad para priorizar atención\n    - `informes_estructura`: Adecuación de estructura de informes\n    - `informes_contenido`: Contenido apropiado para distribución oficial\n    - `alineacion_protocolos`: Alineación con protocolos de actuación","operationId":"crear_evaluacion_api_evaluaciones_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/EvaluacionRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EvaluacionResponse"}}}},"500":{"description":"Error del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/evaluaciones/estadisticas":{"get":{"tags":["Evaluaciones"],"summary":"Obtener estadísticas de evaluaciones","description":"Obtiene estadísticas agregadas y anonimizadas de todas las evaluaciones","operationId":"obtener_estadisticas_api_evaluaciones_estadisticas_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EstadisticasEvaluacion"}}}},"500":{"description":"Error del servidor"}}}},"/api/evaluaciones/preguntas/{perfil}":{"get":{"tags":["Evaluaciones"],"summary":"Obtener preguntas para un perfil","description":"Obtiene el listado de preguntas según el perfil del evaluador","operationId":"obtener_preguntas_api_evaluaciones_preguntas__perfil__get","parameters":[{"name":"perfil","in":"path","required":true,"schema":{"$ref":"#/components/schemas/PerfilEvaluacion"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"500":{"description":"Error del servidor"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"summary":"Raíz de la API","description":"Endpoint raíz que devuelve información básica de la API","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/health":{"get":{"tags":["Utilidades"],"summary":"Estado de salud de la API","description":"Verifica que todos los componentes estén cargados correctamente","operationId":"health_check_api_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthCheck"}}}}}}},"/api/metrics":{"get":{"tags":["Utilidades"],"summary":"Métricas del sistema","description":"Devuelve métricas de rendimiento y uso del sistema","operationId":"get_metrics_api_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/admin/cache/clear":{"post":{"tags":["Admin"],"summary":"Limpiar caché","description":"Limpia todo el caché de la aplicación (requiere autenticación)","operationId":"clear_cache_endpoint_admin_cache_clear_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/embalses":{"get":{"tags":["Embalses"],"summary":"Listar embalses disponibles","description":"Devuelve la lista completa de embalses disponibles en el sistema con sus datos básicos","operationId":"listar_embalses_api_embalses_get","parameters":[{"name":"fecha_referencia","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Fecha de referencia para niveles (YYYY-MM-DD)","title":"Fecha Referencia"},"description":"Fecha de referencia para niveles (YYYY-MM-DD)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/EmbalseInfo"},"title":"Response Listar Embalses Api Embalses Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/embalses/{codigo_saih}/historico":{"get":{"tags":["Embalses"],"summary":"Obtener serie histórica de un embalse","description":"Devuelve los datos históricos de nivel, precipitación, temperatura y caudal del embalse","operationId":"obtener_historico_api_embalses__codigo_saih__historico_get","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","title":"Codigo Saih"}},{"name":"start_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Fecha inicial (YYYY-MM-DD)","title":"Start Date"},"description":"Fecha inicial (YYYY-MM-DD)"},{"name":"end_date","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Fecha final (YYYY-MM-DD)","title":"End Date"},"description":"Fecha final (YYYY-MM-DD)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/SerieHistoricaPunto"},"title":"Response Obtener Historico Api Embalses  Codigo Saih  Historico Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/embalses/{codigo_saih}/resumen":{"get":{"tags":["Embalses"],"summary":"Obtener resumen estadístico del embalse","description":"Devuelve un resumen con el último nivel registrado y estadísticas anuales","operationId":"obtener_resumen_api_embalses__codigo_saih__resumen_get","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","title":"Codigo Saih"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmbalseResumen"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/predicciones/{codigo_saih}":{"post":{"tags":["Predicción"],"summary":"Generar predicción para un embalse","description":"Ejecuta el modelo LSTM en los dos modos (hist, aemet_ruido) y devuelve las predicciones","operationId":"generar_prediccion_api_predicciones__codigo_saih__post","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","title":"Codigo Saih"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PrediccionRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PrediccionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/predicciones/{codigo_saih}/ultimo":{"get":{"tags":["Predicción"],"summary":"Predicción rápida con parámetros por defecto","description":"Genera una predicción usando la última fecha disponible y horizonte por defecto (90 días)","operationId":"prediccion_ultimo_api_predicciones__codigo_saih__ultimo_get","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","title":"Codigo Saih"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PrediccionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/predicciones/lote":{"post":{"tags":["Predicción"],"summary":"Predicción en lote para múltiples embalses","description":"Genera predicciones para varios embalses con parámetros comunes","operationId":"prediccion_lote_api_predicciones_lote_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PrediccionLoteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/PrediccionResponse"},"type":"array","title":"Response Prediccion Lote Api Predicciones Lote Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/embalses/{codigo_saih}/riesgo":{"post":{"tags":["Riesgo"],"summary":"Análisis de riesgo del embalse","description":"Evalúa el riesgo basándose en predicciones operativas y umbrales configurables","operationId":"analizar_riesgo_api_embalses__codigo_saih__riesgo_post","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","title":"Codigo Saih"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RiesgoRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RiesgoEmbalse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/embalses/{codigo_saih}/recomendacion":{"get":{"tags":["Riesgo"],"summary":"Recomendación rápida","description":"Genera una recomendación operativa con parámetros por defecto","operationId":"obtener_recomendacion_api_embalses__codigo_saih__recomendacion_get","parameters":[{"name":"codigo_saih","in":"path","required":true,"schema":{"type":"string","title":"Codigo Saih"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RiesgoEmbalse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/demarcaciones":{"get":{"tags":["Geografía"],"summary":"Listar demarcaciones hidrográficas","description":"Devuelve todas las demarcaciones hidrográficas con su información organizativa","operationId":"listar_demarcaciones_api_demarcaciones_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/Demarcacion"},"type":"array","title":"Response Listar Demarcaciones Api Demarcaciones Get"}}}}}}},"/api/demarcaciones/{id_demarcacion}":{"get":{"tags":["Geografía"],"summary":"Detalle de demarcación","description":"Obtiene información detallada de una demarcación hidrográfica","operationId":"obtener_demarcacion_api_demarcaciones__id_demarcacion__get","parameters":[{"name":"id_demarcacion","in":"path","required":true,"schema":{"type":"string","title":"Id Demarcacion"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Demarcacion"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/demarcaciones/{id_demarcacion}/embalses":{"get":{"tags":["Geografía"],"summary":"Embalses de una demarcación","description":"Lista todos los embalses pertenecientes a una demarcación hidrográfica","operationId":"listar_embalses_demarcacion_api_demarcaciones__id_demarcacion__embalses_get","parameters":[{"name":"id_demarcacion","in":"path","required":true,"schema":{"type":"string","title":"Id Demarcacion"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"type":"object","additionalProperties":true},"title":"Response Listar Embalses Demarcacion Api Demarcaciones  Id Demarcacion  Embalses Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/organismos":{"get":{"tags":["Geografía"],"summary":"Listar organismos gestores","description":"Devuelve todos los organismos gestores (Confederaciones y Administraciones Autonómicas)","operationId":"listar_organismos_api_organismos_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/OrganismoGestor"},"type":"array","title":"Response Listar Organismos Api Organismos Get"}}}}}}},"/api/geografia/comunidades":{"get":{"tags":["Geografía"],"summary":"Listar comunidades autónomas","description":"Devuelve todas las comunidades autónomas con número de embalses","operationId":"listar_comunidades_api_geografia_comunidades_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/Geografia"},"type":"array","title":"Response Listar Comunidades Api Geografia Comunidades Get"}}}}}}},"/api/geografia/provincias":{"get":{"tags":["Geografía"],"summary":"Listar provincias","description":"Devuelve todas las provincias, opcionalmente filtradas por comunidad autónoma","operationId":"listar_provincias_api_geografia_provincias_get","parameters":[{"name":"id_ccaa","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"ID de comunidad autónoma para filtrar","title":"Id Ccaa"},"description":"ID de comunidad autónoma para filtrar"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Geografia"},"title":"Response Listar Provincias Api Geografia Provincias Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/estadisticas/ccaa/{id_ccaa}":{"get":{"tags":["Estadísticas"],"summary":"Estadísticas por comunidad autónoma","description":"Calcula estadísticas agregadas de embalses en una comunidad autónoma","operationId":"estadisticas_ccaa_api_estadisticas_ccaa__id_ccaa__get","parameters":[{"name":"id_ccaa","in":"path","required":true,"schema":{"type":"integer","title":"Id Ccaa"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EstadisticasRegion"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/estadisticas/provincia/{id_provincia}":{"get":{"tags":["Estadísticas"],"summary":"Estadísticas por provincia","description":"Calcula estadísticas agregadas de embalses en una provincia","operationId":"estadisticas_provincia_api_estadisticas_provincia__id_provincia__get","parameters":[{"name":"id_provincia","in":"path","required":true,"schema":{"type":"integer","title":"Id Provincia"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EstadisticasRegion"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/estadisticas/demarcacion/{id_demarcacion}":{"get":{"tags":["Estadísticas"],"summary":"Estadísticas por demarcación","description":"Calcula estadísticas agregadas de embalses en una demarcación hidrográfica","operationId":"estadisticas_demarcacion_api_estadisticas_demarcacion__id_demarcacion__get","parameters":[{"name":"id_demarcacion","in":"path","required":true,"schema":{"type":"string","title":"Id Demarcacion"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EstadisticasRegion"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/comparar":{"post":{"tags":["Estadísticas"],"summary":"Comparar embalses","description":"Compara niveles actuales y tendencias de múltiples embalses","operationId":"comparar_embalses_api_comparar_post","parameters":[{"name":"codigos_saih","in":"query","required":true,"schema":{"type":"array","items":{"type":"string"},"description":"Códigos de embalses a comparar","title":"Codigos Saih"},"description":"Códigos de embalses a comparar"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ComparacionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Alerta":{"properties":{"id":{"type":"string","title":"Id","description":"ID único de la alerta"},"codigo_saih":{"type":"string","title":"Codigo Saih","description":"Código SAIH del embalse"},"ubicacion":{"type":"string","title":"Ubicacion","description":"Nombre del embalse"},"tipo":{"type":"string","title":"Tipo","description":"Tipo de alerta"},"severidad":{"type":"string","title":"Severidad","description":"Severidad: info, warning, error, critical"},"mensaje":{"type":"string","title":"Mensaje","description":"Mensaje descriptivo de la alerta"},"valor_actual":{"type":"number","title":"Valor Actual","description":"Valor actual que generó la alerta"},"umbral":{"type":"number","title":"Umbral","description":"Umbral que se superó o no alcanzó"},"fecha_deteccion":{"type":"string","title":"Fecha Deteccion","description":"Fecha de detección"},"demarcacion":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Demarcacion","description":"Demarcación hidrográfica"}},"type":"object","required":["id","codigo_saih","ubicacion","tipo","severidad","mensaje","valor_actual","umbral","fecha_deteccion"],"title":"Alerta","description":"Información de una alerta del sistema.","example":{"codigo_saih":"E001","demarcacion":"Demarcación Hidrográfica Galicia-Costa","fecha_deteccion":"2024-12-14","id":"E001_nivel_bajo","mensaje":"Nivel bajo: 28.5% de capacidad","severidad":"warning","tipo":"NIVEL_BAJO","ubicacion":"Belesar","umbral":196.2,"valor_actual":186.4}},"AlertasResponse":{"properties":{"fecha_referencia":{"type":"string","title":"Fecha Referencia","description":"Fecha de referencia"},"total_alertas":{"type":"integer","title":"Total Alertas","description":"Número total de alertas"},"alertas_por_severidad":{"additionalProperties":{"type":"integer"},"type":"object","title":"Alertas Por Severidad","description":"Conteo por severidad"},"alertas":{"items":{"$ref":"#/components/schemas/Alerta"},"type":"array","title":"Alertas","description":"Lista de alertas"}},"type":"object","required":["fecha_referencia","total_alertas","alertas_por_severidad","alertas"],"title":"AlertasResponse","description":"Response con lista de alertas activas.","example":{"alertas":[],"alertas_por_severidad":{"critical":1,"error":0,"info":1,"warning":3},"fecha_referencia":"2024-12-14","total_alertas":5}},"ComparacionEmbalse":{"properties":{"codigo_saih":{"type":"string","title":"Codigo Saih"},"ubicacion":{"type":"string","title":"Ubicacion"},"nivel_actual":{"type":"number","title":"Nivel Actual"},"nivel_hace_30d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Hace 30D"},"nivel_hace_90d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Hace 90D"},"variacion_30d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Variacion 30D"},"variacion_90d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Variacion 90D"},"porcentaje_capacidad":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Porcentaje Capacidad"},"tendencia":{"type":"string","title":"Tendencia","description":"Tendencia: 'subiendo', 'bajando' o 'estable'"}},"type":"object","required":["codigo_saih","ubicacion","nivel_actual","tendencia"],"title":"ComparacionEmbalse","description":"Datos de un embalse para comparación."},"ComparacionResponse":{"properties":{"fecha_consulta":{"type":"string","title":"Fecha Consulta"},"embalses":{"items":{"$ref":"#/components/schemas/ComparacionEmbalse"},"type":"array","title":"Embalses"},"resumen":{"additionalProperties":true,"type":"object","title":"Resumen","description":"Resumen estadístico de la comparación"}},"type":"object","required":["fecha_consulta","embalses","resumen"],"title":"ComparacionResponse","description":"Respuesta de comparación de múltiples embalses."},"DashboardKPIs":{"properties":{"fecha_referencia":{"type":"string","title":"Fecha Referencia","description":"Fecha de referencia de los datos"},"num_embalses":{"type":"integer","title":"Num Embalses","description":"Número total de embalses monitorizados"},"capacidad_total":{"type":"number","title":"Capacidad Total","description":"Capacidad total del sistema (msnm)"},"nivel_total_actual":{"type":"number","title":"Nivel Total Actual","description":"Nivel total actual (msnm)"},"porcentaje_llenado_promedio":{"type":"number","title":"Porcentaje Llenado Promedio","description":"Porcentaje promedio de llenado"},"num_embalses_criticos":{"type":"integer","title":"Num Embalses Criticos","description":"Número de embalses en estado crítico"},"num_alertas_activas":{"type":"integer","title":"Num Alertas Activas","description":"Número de alertas activas"},"tendencia":{"type":"string","title":"Tendencia","description":"Tendencia general: aumento, descenso, estable"}},"type":"object","required":["fecha_referencia","num_embalses","capacidad_total","nivel_total_actual","porcentaje_llenado_promedio","num_embalses_criticos","num_alertas_activas","tendencia"],"title":"DashboardKPIs","description":"KPIs agregados del sistema para el dashboard.","example":{"capacidad_total":5000.0,"fecha_referencia":"2024-12-14","nivel_total_actual":3500.0,"num_alertas_activas":5,"num_embalses":25,"num_embalses_criticos":3,"porcentaje_llenado_promedio":70.0,"tendencia":"estable"}},"Demarcacion":{"properties":{"id":{"type":"string","title":"Id","description":"Código oficial de la demarcación (ej: ES090)"},"nombre":{"type":"string","title":"Nombre","description":"Nombre de la demarcación"},"organismo_gestor":{"type":"string","title":"Organismo Gestor","description":"Organismo responsable"},"tipo_gestion":{"type":"string","title":"Tipo Gestion","description":"Tipo de gestión (Estatal/Autonómica)"},"comunidades":{"items":{"type":"string"},"type":"array","title":"Comunidades","description":"Comunidades autónomas que atraviesa"},"num_embalses":{"type":"integer","title":"Num Embalses","description":"Número de embalses en la demarcación"}},"type":"object","required":["id","nombre","organismo_gestor","tipo_gestion","comunidades","num_embalses"],"title":"Demarcacion","description":"Información de una demarcación hidrográfica.","example":{"comunidades":["Galicia"],"id":"ES090","nombre":"Demarcación Hidrográfica Galicia-Costa","num_embalses":15,"organismo_gestor":"Augas de Galicia","tipo_gestion":"Autonómica"}},"EmbalseActual":{"properties":{"codigo_saih":{"type":"string","title":"Codigo Saih"},"ubicacion":{"type":"string","title":"Ubicacion"},"municipio":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Municipio"},"provincia":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Provincia"},"comunidad_autonoma":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Comunidad Autonoma"},"demarcacion":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Demarcacion"},"fecha_referencia":{"type":"string","title":"Fecha Referencia","description":"Fecha de referencia de los datos"},"nivel_actual":{"type":"number","title":"Nivel Actual","description":"Nivel actual (msnm)"},"nivel_maximo":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Maximo","description":"Nivel máximo (msnm)"},"porcentaje_llenado":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Porcentaje Llenado","description":"Porcentaje de llenado"},"estado":{"type":"string","title":"Estado","description":"Estado del embalse: normal, bajo, critico_bajo, alto, critico_alto"},"precipitacion_actual":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Precipitacion Actual","description":"Precipitación reciente (mm)"},"temperatura_actual":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Temperatura Actual","description":"Temperatura actual (°C)"},"caudal_actual":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Caudal Actual","description":"Caudal actual (m³/s)"},"nivel_min_30d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Min 30D","description":"Nivel mínimo últimos 30 días"},"nivel_max_30d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Max 30D","description":"Nivel máximo últimos 30 días"},"nivel_medio_30d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Medio 30D","description":"Nivel medio últimos 30 días"},"variacion_30d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Variacion 30D","description":"Variación respecto hace 30 días"},"precipitacion_acumulada_30d":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Precipitacion Acumulada 30D","description":"Precipitación acumulada 30 días (mm)"}},"type":"object","required":["codigo_saih","ubicacion","fecha_referencia","nivel_actual","estado"],"title":"EmbalseActual","description":"Datos actuales de un embalse para una fecha de referencia.","example":{"caudal_actual":14.69,"codigo_saih":"E001","comunidad_autonoma":"Galicia","demarcacion":"Demarcación Hidrográfica Galicia-Costa","estado":"normal","fecha_referencia":"2024-12-14","municipio":"Portomarín","nivel_actual":308.5,"nivel_max_30d":318.7,"nivel_maximo":654.0,"nivel_medio_30d":306.2,"nivel_min_30d":295.3,"porcentaje_llenado":47.2,"precipitacion_actual":5.2,"precipitacion_acumulada_30d":156.8,"provincia":"Lugo","temperatura_actual":8.4,"ubicacion":"Belesar","variacion_30d":2.3}},"EmbalseInfo":{"properties":{"codigo_saih":{"type":"string","title":"Codigo Saih","description":"Código SAIH del embalse"},"ubicacion":{"type":"string","title":"Ubicacion","description":"Nombre/ubicación del embalse"},"municipio":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Municipio","description":"Municipio"},"provincia":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Provincia","description":"Provincia"},"comunidad_autonoma":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Comunidad Autonoma","description":"Comunidad Autónoma"},"demarcacion":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Demarcacion","description":"Demarcación hidrográfica"},"organismo_gestor":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Organismo Gestor","description":"Organismo gestor"},"tipo_gestion":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tipo Gestion","description":"Tipo de gestión (Estatal/Autonómica)"},"coord_x":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Coord X","description":"Coordenada X (UTM ETRS89)"},"coord_y":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Coord Y","description":"Coordenada Y (UTM ETRS89)"},"nivel_maximo":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Maximo","description":"Nivel máximo del embalse (msnm)"},"ultimo_nivel":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Ultimo Nivel","description":"Último nivel registrado (msnm)"},"fecha_ultimo_registro":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Fecha Ultimo Registro","description":"Fecha del último registro"}},"type":"object","required":["codigo_saih","ubicacion"],"title":"EmbalseInfo","description":"Información completa de un embalse.","example":{"codigo_saih":"E001","comunidad_autonoma":"Galicia","coord_x":612345.67,"coord_y":4756789.12,"demarcacion":"Demarcación Hidrográfica Galicia-Costa","fecha_ultimo_registro":"2024-12-14","municipio":"Portomarín","nivel_maximo":654.0,"organismo_gestor":"Augas de Galicia","provincia":"Lugo","tipo_gestion":"Autonómica","ubicacion":"Belesar","ultimo_nivel":308.5}},"EmbalseResumen":{"properties":{"codigo_saih":{"type":"string","title":"Codigo Saih"},"ultimo_nivel":{"type":"number","title":"Ultimo Nivel","description":"Último nivel registrado"},"fecha_ultimo_registro":{"type":"string","title":"Fecha Ultimo Registro","description":"Fecha del último registro"},"nivel_medio_anual":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Medio Anual","description":"Nivel medio en el último año"},"nivel_min_anual":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Min Anual","description":"Nivel mínimo en el último año"},"nivel_max_anual":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Max Anual","description":"Nivel máximo en el último año"}},"type":"object","required":["codigo_saih","ultimo_nivel","fecha_ultimo_registro"],"title":"EmbalseResumen","description":"Resumen estadístico de un embalse.","example":{"codigo_saih":"E001","fecha_ultimo_registro":"2024-12-14","nivel_max_anual":318.7,"nivel_medio_anual":306.2,"nivel_min_anual":295.3,"ultimo_nivel":308.5}},"EstadisticasEvaluacion":{"properties":{"total_evaluaciones":{"type":"integer","title":"Total Evaluaciones"},"por_perfil":{"additionalProperties":true,"type":"object","title":"Por Perfil"},"distribucion_experiencia":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Distribucion Experiencia"},"comentarios_recientes":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Comentarios Recientes"}},"type":"object","required":["total_evaluaciones","por_perfil","distribucion_experiencia","comentarios_recientes"],"title":"EstadisticasEvaluacion","description":"Estadísticas agregadas de evaluaciones."},"EstadisticasRecomendaciones":{"properties":{"total_embalses_monitorizados":{"type":"integer","title":"Total Embalses Monitorizados"},"embalses_con_recomendaciones":{"type":"integer","title":"Embalses Con Recomendaciones"},"recomendaciones_totales_generadas":{"type":"integer","title":"Recomendaciones Totales Generadas"},"ultima_generacion":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Ultima Generacion"},"distribucion_riesgos":{"additionalProperties":true,"type":"object","title":"Distribucion Riesgos","description":"Distribución de niveles de riesgo"},"promedio_dias_horizonte":{"type":"number","title":"Promedio Dias Horizonte"},"promedio_mae":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Promedio Mae"}},"type":"object","required":["total_embalses_monitorizados","embalses_con_recomendaciones","recomendaciones_totales_generadas","ultima_generacion","distribucion_riesgos","promedio_dias_horizonte","promedio_mae"],"title":"EstadisticasRecomendaciones","description":"Estadísticas generales del sistema de recomendaciones.","example":{"distribucion_riesgos":{"ALTO":2,"BAJO":30,"MODERADO":12,"SEQUIA":1},"embalses_con_recomendaciones":45,"promedio_dias_horizonte":8.5,"promedio_mae":9.3,"recomendaciones_totales_generadas":1523,"total_embalses_monitorizados":50,"ultima_generacion":"2024-12-14T10:30:00"}},"EstadisticasRegion":{"properties":{"region_nombre":{"type":"string","title":"Region Nombre","description":"Nombre de la región"},"region_tipo":{"type":"string","title":"Region Tipo","description":"Tipo de región (ccaa/provincia/demarcacion)"},"num_embalses":{"type":"integer","title":"Num Embalses","description":"Número de embalses"},"nivel_total_actual":{"type":"number","title":"Nivel Total Actual","description":"Nivel total actual (msnm)"},"capacidad_total":{"type":"number","title":"Capacidad Total","description":"Capacidad total (msnm)"},"porcentaje_llenado":{"type":"number","title":"Porcentaje Llenado","description":"Porcentaje de llenado promedio"},"nivel_promedio":{"type":"number","title":"Nivel Promedio","description":"Nivel promedio (msnm)"},"nivel_min":{"type":"number","title":"Nivel Min","description":"Nivel mínimo (msnm)"},"nivel_max":{"type":"number","title":"Nivel Max","description":"Nivel máximo (msnm)"},"ultima_actualizacion":{"type":"string","title":"Ultima Actualizacion","description":"Fecha de última actualización"}},"type":"object","required":["region_nombre","region_tipo","num_embalses","nivel_total_actual","capacidad_total","porcentaje_llenado","nivel_promedio","nivel_min","nivel_max","ultima_actualizacion"],"title":"EstadisticasRegion","description":"Estadísticas agregadas de una región.","example":{"capacidad_total":15000.0,"nivel_max":654.0,"nivel_min":45.2,"nivel_promedio":277.8,"nivel_total_actual":12500.5,"num_embalses":45,"porcentaje_llenado":83.3,"region_nombre":"Galicia","region_tipo":"ccaa","ultima_actualizacion":"2024-12-14"}},"EvaluacionRequest":{"properties":{"nombre":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Nombre","description":"Nombre del evaluador (opcional)"},"email":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Email","description":"Email del evaluador (opcional)"},"organizacion":{"anyOf":[{"type":"string","maxLength":150},{"type":"null"}],"title":"Organizacion","description":"Organización/entidad"},"perfil":{"$ref":"#/components/schemas/PerfilEvaluacion","description":"Perfil del evaluador"},"anos_experiencia":{"anyOf":[{"type":"integer","maximum":50.0,"minimum":0.0},{"type":"null"}],"title":"Anos Experiencia","description":"Años de experiencia"},"respuestas":{"additionalProperties":{"type":"integer"},"type":"object","title":"Respuestas","description":"Respuestas a las preguntas (clave: pregunta_id, valor: 1-5)"},"comentarios":{"anyOf":[{"type":"string","maxLength":1000},{"type":"null"}],"title":"Comentarios","description":"Comentarios adicionales"}},"type":"object","required":["perfil","respuestas"],"title":"EvaluacionRequest","description":"Request para crear una evaluación."},"EvaluacionResponse":{"properties":{"id":{"type":"integer","title":"Id"},"fecha_evaluacion":{"type":"string","format":"date-time","title":"Fecha Evaluacion"},"perfil":{"type":"string","title":"Perfil"},"mensaje":{"type":"string","title":"Mensaje","default":"Evaluación registrada correctamente"}},"type":"object","required":["id","fecha_evaluacion","perfil"],"title":"EvaluacionResponse","description":"Response de evaluación creada."},"Geografia":{"properties":{"id":{"type":"integer","title":"Id","description":"ID de la entidad"},"nombre":{"type":"string","title":"Nombre","description":"Nombre de la entidad"},"tipo":{"type":"string","title":"Tipo","description":"Tipo: 'ccaa', 'provincia' o 'municipio'"},"padre":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Padre","description":"Nombre de la entidad padre"},"num_embalses":{"type":"integer","title":"Num Embalses","description":"Número de embalses en esta ubicación","default":0}},"type":"object","required":["id","nombre","tipo"],"title":"Geografia","description":"Información geográfica (CCAA, provincia o municipio).","example":{"id":15,"nombre":"Galicia","num_embalses":45,"tipo":"ccaa"}},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HealthCheck":{"properties":{"status":{"type":"string","title":"Status"},"version":{"type":"string","title":"Version"},"model_loaded":{"type":"boolean","title":"Model Loaded"},"scalers_loaded":{"type":"boolean","title":"Scalers Loaded"},"data_loaded":{"type":"boolean","title":"Data Loaded"},"num_embalses":{"type":"integer","title":"Num Embalses"}},"type":"object","required":["status","version","model_loaded","scalers_loaded","data_loaded","num_embalses"],"title":"HealthCheck","description":"Estado de salud de la API."},"InformeRequest":{"properties":{"embalse_id":{"type":"string","title":"Embalse Id","description":"Código SAIH del embalse"},"nombre_embalse":{"type":"string","title":"Nombre Embalse","description":"Nombre del embalse"},"tipo_informe":{"$ref":"#/components/schemas/TipoInforme","description":"Tipo: diario o semanal"},"fecha_generacion":{"type":"string","format":"date-time","title":"Fecha Generacion","description":"Fecha de generación"},"usuario":{"type":"string","title":"Usuario","description":"Usuario que solicita el informe","default":"Miguel Pastoriza Santaclara"},"model_version":{"type":"string","title":"Model Version","description":"Versión del modelo predictivo usado","default":"v1.0"},"datos_actual":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Datos Actual","description":"Datos del estado actual"},"prediccion":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Prediccion","description":"Datos de la predicción"},"riesgos":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Riesgos","description":"Análisis de riesgos"},"metricas_modelo":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metricas Modelo","description":"Métricas de calidad"},"datos_historicos_semana":{"anyOf":[{"items":{},"type":"array"},{"type":"null"}],"title":"Datos Historicos Semana","description":"Evolución de la última semana"},"escenarios":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Escenarios","description":"Análisis de escenarios (optimista/pesimista)"},"fecha_inicio_periodo":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Fecha Inicio Periodo"},"fecha_fin_periodo":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Fecha Fin Periodo"}},"type":"object","required":["embalse_id","nombre_embalse","tipo_informe"],"title":"InformeRequest","description":"Request para generar un informe completo."},"InformeResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"pdf_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Pdf Url","description":"URL para descargar PDF"},"html_url":{"type":"string","title":"Html Url","description":"URL para previsualización HTML"},"informe_id":{"type":"string","title":"Informe Id","description":"ID único del informe"},"fecha_generacion":{"type":"string","format":"date-time","title":"Fecha Generacion"},"metadata":{"additionalProperties":true,"type":"object","title":"Metadata","description":"Metadatos del informe"}},"type":"object","required":["success","html_url","informe_id","fecha_generacion","metadata"],"title":"InformeResponse","description":"Response de informe generado."},"ListaRecomendacionesResponse":{"properties":{"total":{"type":"integer","title":"Total","description":"Total de recomendaciones"},"recomendaciones":{"items":{"$ref":"#/components/schemas/RecomendacionOperativaDTO"},"type":"array","title":"Recomendaciones","description":"Lista de recomendaciones"},"filtros_aplicados":{"additionalProperties":true,"type":"object","title":"Filtros Aplicados","description":"Filtros aplicados en la consulta"}},"type":"object","required":["total","recomendaciones"],"title":"ListaRecomendacionesResponse","description":"Respuesta para listado de recomendaciones.","example":{"filtros_aplicados":{"fecha_inicio":"2024-12-14","nivel_riesgo":"ALTO"},"recomendaciones":[],"total":15}},"NivelRiesgo":{"type":"string","enum":["BAJO","MODERADO","ALTO","SEQUIA"],"title":"NivelRiesgo","description":"Niveles de riesgo para embalses."},"OrganismoGestor":{"properties":{"id":{"type":"integer","title":"Id","description":"ID del organismo"},"nombre":{"type":"string","title":"Nombre","description":"Nombre del organismo"},"tipo_gestion":{"type":"string","title":"Tipo Gestion","description":"Tipo de gestión (Estatal/Autonómica)"},"num_demarcaciones":{"type":"integer","title":"Num Demarcaciones","description":"Número de demarcaciones gestionadas"}},"type":"object","required":["id","nombre","tipo_gestion","num_demarcaciones"],"title":"OrganismoGestor","description":"Información de un organismo gestor.","example":{"id":1,"nombre":"Confederación Hidrográfica del Miño-Sil","num_demarcaciones":1,"tipo_gestion":"Estatal"}},"PerfilEvaluacion":{"type":"string","enum":["tecnico","gestion"],"title":"PerfilEvaluacion","description":"Perfil del evaluador."},"PrediccionLoteRequest":{"properties":{"codigos_saih":{"items":{"type":"string"},"type":"array","title":"Codigos Saih","description":"Lista de códigos SAIH"},"fecha_inicio":{"type":"string","title":"Fecha Inicio","description":"Fecha de inicio común"},"horizonte_dias":{"type":"integer","maximum":180.0,"minimum":1.0,"title":"Horizonte Dias","description":"Horizonte común","default":90}},"type":"object","required":["codigos_saih","fecha_inicio"],"title":"PrediccionLoteRequest","description":"Request para predicciones de múltiples embalses.","example":{"codigos_saih":["E001","E002","E003"],"fecha_inicio":"2024-02-01","horizonte_dias":90}},"PrediccionPunto":{"properties":{"fecha":{"type":"string","title":"Fecha","description":"Fecha de la predicción"},"pred_hist":{"type":"number","title":"Pred Hist","description":"Predicción solo con datos históricos"},"pred":{"type":"number","title":"Pred","description":"Predicción operativa (incluye datos meteorológicos)"},"nivel_real":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Real","description":"Nivel real observado (si disponible)"}},"type":"object","required":["fecha","pred_hist","pred"],"title":"PrediccionPunto","description":"Punto de predicción con dos escenarios.","example":{"fecha":"2024-03-01","nivel_real":306.5,"pred":306.8,"pred_hist":305.5}},"PrediccionRequest":{"properties":{"fecha_inicio":{"type":"string","title":"Fecha Inicio","description":"Fecha de inicio de la predicción (YYYY-MM-DD)"},"horizonte_dias":{"type":"integer","maximum":180.0,"minimum":1.0,"title":"Horizonte Dias","description":"Horizonte de predicción en días (1-180)","default":90}},"type":"object","required":["fecha_inicio"],"title":"PrediccionRequest","description":"Request para generar predicción.","example":{"fecha_inicio":"2024-02-01","horizonte_dias":90}},"PrediccionResponse":{"properties":{"codigo_saih":{"type":"string","title":"Codigo Saih"},"fecha_inicio":{"type":"string","title":"Fecha Inicio"},"horizonte_dias":{"type":"integer","title":"Horizonte Dias"},"predicciones":{"items":{"$ref":"#/components/schemas/PrediccionPunto"},"type":"array","title":"Predicciones"}},"type":"object","required":["codigo_saih","fecha_inicio","horizonte_dias","predicciones"],"title":"PrediccionResponse","description":"Response de predicción completa.","example":{"codigo_saih":"E001","fecha_inicio":"2024-02-01","horizonte_dias":90,"predicciones":[{"fecha":"2024-02-02","nivel_real":306.5,"pred":306.8,"pred_hist":305.5}]}},"RecomendacionConfigCreate":{"properties":{"codigo_saih":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Codigo Saih","description":"Código SAIH del embalse (NULL para config global)"},"nombre":{"type":"string","title":"Nombre","description":"Nombre descriptivo de la configuración"},"descripcion":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Descripcion","description":"Descripción detallada"},"umbral_alto_relativo":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Umbral Alto Relativo","description":"Umbral para riesgo alto (% de nivel_maximo)","default":0.95},"umbral_moderado_relativo":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Umbral Moderado Relativo","description":"Umbral para riesgo moderado","default":0.8},"umbral_minimo_relativo":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Umbral Minimo Relativo","description":"Umbral mínimo para sequía","default":0.3},"horizonte_dias":{"type":"integer","maximum":180.0,"minimum":1.0,"title":"Horizonte Dias","description":"Horizonte de predicción en días","default":7},"k_sigma":{"type":"number","maximum":5.0,"minimum":0.0,"title":"K Sigma","description":"Multiplicador para intervalo de confianza","default":2.0},"prob_umbral_moderado":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Prob Umbral Moderado","description":"Probabilidad umbral para alerta moderada","default":0.3},"prob_umbral_alto":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Prob Umbral Alto","description":"Probabilidad umbral para alerta alta","default":0.5},"activo":{"type":"boolean","title":"Activo","description":"Si la configuración está activa","default":true}},"type":"object","required":["nombre"],"title":"RecomendacionConfigCreate","description":"Modelo para crear configuración de recomendaciones.","example":{"activo":true,"codigo_saih":"E001","descripcion":"Configuración específica para Belesar con umbrales ajustados","horizonte_dias":14,"k_sigma":2.5,"nombre":"Config Embalse Belesar","umbral_alto_relativo":0.93,"umbral_minimo_relativo":0.25,"umbral_moderado_relativo":0.78}},"RecomendacionConfigResponse":{"properties":{"codigo_saih":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Codigo Saih","description":"Código SAIH del embalse (NULL para config global)"},"nombre":{"type":"string","title":"Nombre","description":"Nombre descriptivo de la configuración"},"descripcion":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Descripcion","description":"Descripción detallada"},"umbral_alto_relativo":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Umbral Alto Relativo","description":"Umbral para riesgo alto (% de nivel_maximo)","default":0.95},"umbral_moderado_relativo":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Umbral Moderado Relativo","description":"Umbral para riesgo moderado","default":0.8},"umbral_minimo_relativo":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Umbral Minimo Relativo","description":"Umbral mínimo para sequía","default":0.3},"horizonte_dias":{"type":"integer","maximum":180.0,"minimum":1.0,"title":"Horizonte Dias","description":"Horizonte de predicción en días","default":7},"k_sigma":{"type":"number","maximum":5.0,"minimum":0.0,"title":"K Sigma","description":"Multiplicador para intervalo de confianza","default":2.0},"prob_umbral_moderado":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Prob Umbral Moderado","description":"Probabilidad umbral para alerta moderada","default":0.3},"prob_umbral_alto":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Prob Umbral Alto","description":"Probabilidad umbral para alerta alta","default":0.5},"activo":{"type":"boolean","title":"Activo","description":"Si la configuración está activa","default":true},"id":{"type":"integer","title":"Id"},"fecha_creacion":{"type":"string","format":"date-time","title":"Fecha Creacion"},"fecha_modificacion":{"type":"string","format":"date-time","title":"Fecha Modificacion"}},"type":"object","required":["nombre","id","fecha_creacion","fecha_modificacion"],"title":"RecomendacionConfigResponse","description":"Modelo de respuesta con configuración completa.","example":{"activo":true,"codigo_saih":"E001","descripcion":"Configuración específica para Belesar con umbrales ajustados","horizonte_dias":14,"k_sigma":2.5,"nombre":"Config Embalse Belesar","umbral_alto_relativo":0.93,"umbral_minimo_relativo":0.25,"umbral_moderado_relativo":0.78}},"RecomendacionOperativaDTO":{"properties":{"id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Id"},"codigo_saih":{"type":"string","title":"Codigo Saih","description":"Código SAIH del embalse"},"ubicacion":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Ubicacion","description":"Nombre del embalse"},"fecha_generacion":{"type":"string","format":"date-time","title":"Fecha Generacion","description":"Fecha y hora de generación"},"fecha_inicio":{"type":"string","format":"date","title":"Fecha Inicio","description":"Fecha de inicio de la predicción"},"horizonte_dias":{"type":"integer","title":"Horizonte Dias","description":"Horizonte de predicción en días"},"nivel_riesgo":{"$ref":"#/components/schemas/NivelRiesgo","description":"Nivel de riesgo calculado"},"nivel_severidad":{"type":"integer","maximum":4.0,"minimum":1.0,"title":"Nivel Severidad","description":"Severidad numérica (1-4)"},"color_hex":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Color Hex","description":"Color para visualización"},"nivel_actual":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Actual","description":"Nivel actual del embalse (msnm)"},"nivel_predicho_min":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Predicho Min","description":"Nivel predicho mínimo (msnm)"},"nivel_predicho_max":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Predicho Max","description":"Nivel predicho máximo (msnm)"},"nivel_predicho_medio":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Predicho Medio","description":"Nivel predicho medio (msnm)"},"nivel_maximo":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Maximo","description":"Capacidad máxima del embalse (msnm)"},"mae_historico":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Mae Historico","description":"MAE histórico del modelo para este embalse"},"rmse_historico":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Rmse Historico","description":"RMSE histórico del modelo"},"probabilidad_superar_umbral":{"anyOf":[{"type":"number","maximum":1.0,"minimum":0.0},{"type":"null"}],"title":"Probabilidad Superar Umbral","description":"Prob. de superar umbral crítico"},"dias_hasta_umbral":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Dias Hasta Umbral","description":"Días hasta alcanzar umbral crítico"},"motivo":{"type":"string","title":"Motivo","description":"Explicación del riesgo asignado"},"accion_recomendada":{"type":"string","title":"Accion Recomendada","description":"Acciones operativas recomendadas"},"config_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Config Id","description":"ID de configuración utilizada"},"version_modelo":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Version Modelo","description":"Versión del modelo de predicción"},"generado_por_llm":{"type":"boolean","title":"Generado Por Llm","description":"Indica si fue generado por IA (Ollama)","default":false},"fuente_recomendacion":{"type":"string","title":"Fuente Recomendacion","description":"Fuente: 'llm', 'plantilla' o 'estatica'","default":"estatica"}},"type":"object","required":["codigo_saih","fecha_generacion","fecha_inicio","horizonte_dias","nivel_riesgo","nivel_severidad","motivo","accion_recomendada"],"title":"RecomendacionOperativaDTO","description":"DTO completo de recomendación operativa.","example":{"accion_recomendada":"Incrementar frecuencia de monitoreo a cada 12 horas. Evaluar posibilidad de desembalses graduales de 15.0 hm³ para mantener margen de seguridad.","codigo_saih":"E001","color_hex":"#FFC107","config_id":1,"dias_hasta_umbral":5,"fecha_generacion":"2024-12-14T10:30:00","fecha_inicio":"2024-12-14","horizonte_dias":7,"id":123,"mae_historico":8.5,"motivo":"El nivel predicho se situará en 81% de capacidad (528.3 hm³) dentro de 7 días. Tendencia: subiendo. Incertidumbre: ±8.5 hm³.","nivel_actual":520.5,"nivel_maximo":654.0,"nivel_predicho_max":542.8,"nivel_predicho_medio":528.3,"nivel_predicho_min":515.2,"nivel_riesgo":"MODERADO","nivel_severidad":2,"probabilidad_superar_umbral":0.35,"rmse_historico":12.3,"ubicacion":"Belesar","version_modelo":"1.0.0"}},"RecomendacionRequest":{"properties":{"fecha_inicio":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Fecha Inicio","description":"Fecha de inicio (YYYY-MM-DD). Si es None, usa hoy"},"horizonte_dias":{"anyOf":[{"type":"integer","maximum":180.0,"minimum":1.0},{"type":"null"}],"title":"Horizonte Dias","description":"Horizonte de predicción. Si es None, usa config del embalse"},"forzar_regeneracion":{"type":"boolean","title":"Forzar Regeneracion","description":"Forzar regeneración aunque exista una reciente","default":false}},"type":"object","title":"RecomendacionRequest","description":"Request para generar recomendación operativa.","example":{"fecha_inicio":"2024-12-14","forzar_regeneracion":false,"horizonte_dias":7}},"RecomendacionResumen":{"properties":{"codigo_saih":{"type":"string","title":"Codigo Saih"},"ubicacion":{"type":"string","title":"Ubicacion"},"nivel_riesgo":{"$ref":"#/components/schemas/NivelRiesgo"},"nivel_severidad":{"type":"integer","title":"Nivel Severidad"},"color_hex":{"type":"string","title":"Color Hex"},"nivel_actual":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Actual"},"nivel_predicho_medio":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Nivel Predicho Medio"},"porcentaje_llenado":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Porcentaje Llenado","description":"% de llenado actual"},"fecha_generacion":{"type":"string","format":"date-time","title":"Fecha Generacion"},"accion_recomendada":{"type":"string","title":"Accion Recomendada"}},"type":"object","required":["codigo_saih","ubicacion","nivel_riesgo","nivel_severidad","color_hex","nivel_actual","nivel_predicho_medio","fecha_generacion","accion_recomendada"],"title":"RecomendacionResumen","description":"Resumen simplificado de recomendación para listados.","example":{"accion_recomendada":"Incrementar frecuencia de monitoreo...","codigo_saih":"E001","color_hex":"#FFC107","fecha_generacion":"2024-12-14T10:30:00","nivel_actual":520.5,"nivel_predicho_medio":528.3,"nivel_riesgo":"MODERADO","nivel_severidad":2,"porcentaje_llenado":79.6,"ubicacion":"Belesar"}},"RiesgoDemarcacionDTO":{"properties":{"id_demarcacion":{"type":"string","title":"Id Demarcacion","description":"Código de demarcación (ej: ES090)"},"demarcacion":{"type":"string","title":"Demarcacion","description":"Nombre de la demarcación"},"organismo_gestor":{"type":"string","title":"Organismo Gestor","description":"Organismo responsable"},"total_embalses":{"type":"integer","title":"Total Embalses","description":"Total de embalses en la demarcación"},"embalses_riesgo_alto":{"type":"integer","title":"Embalses Riesgo Alto","description":"Embalses con riesgo ALTO","default":0},"embalses_riesgo_moderado":{"type":"integer","title":"Embalses Riesgo Moderado","description":"Embalses con riesgo MODERADO","default":0},"embalses_riesgo_sequia":{"type":"integer","title":"Embalses Riesgo Sequia","description":"Embalses con riesgo SEQUÍA","default":0},"embalses_riesgo_bajo":{"type":"integer","title":"Embalses Riesgo Bajo","description":"Embalses con riesgo BAJO","default":0},"porcentaje_criticos":{"type":"number","title":"Porcentaje Criticos","description":"% de embalses en situación crítica (ALTO o SEQUÍA)","default":0.0},"ultima_actualizacion":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Ultima Actualizacion","description":"Última actualización de recomendaciones"},"embalses_criticos":{"items":{"$ref":"#/components/schemas/RecomendacionResumen"},"type":"array","title":"Embalses Criticos","description":"Detalle de embalses críticos"}},"type":"object","required":["id_demarcacion","demarcacion","organismo_gestor","total_embalses"],"title":"RiesgoDemarcacionDTO","description":"Resumen de riesgos agregados por demarcación.","example":{"demarcacion":"Galicia-Costa","embalses_criticos":[],"embalses_riesgo_alto":2,"embalses_riesgo_bajo":8,"embalses_riesgo_moderado":5,"embalses_riesgo_sequia":0,"id_demarcacion":"ES090","organismo_gestor":"Augas de Galicia","porcentaje_criticos":13.33,"total_embalses":15,"ultima_actualizacion":"2024-12-14T10:30:00"}},"RiesgoEmbalse":{"properties":{"codigo_saih":{"type":"string","title":"Codigo Saih"},"fecha_analisis":{"type":"string","title":"Fecha Analisis"},"horizonte_dias":{"type":"integer","title":"Horizonte Dias"},"nivel_minimo_predicho":{"type":"number","title":"Nivel Minimo Predicho","description":"Nivel mínimo previsto en el horizonte"},"nivel_maximo_predicho":{"type":"number","title":"Nivel Maximo Predicho","description":"Nivel máximo previsto en el horizonte"},"nivel_medio_predicho":{"type":"number","title":"Nivel Medio Predicho","description":"Nivel medio previsto"},"prob_riesgo_bajo":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Prob Riesgo Bajo","description":"Probabilidad de nivel bajo (0-1)"},"prob_riesgo_alto":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Prob Riesgo Alto","description":"Probabilidad de nivel alto (0-1)"},"prob_riesgo_medio":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Prob Riesgo Medio","description":"Probabilidad de nivel dentro del rango seguro (0-1)"},"categoria_riesgo":{"type":"string","title":"Categoria Riesgo","description":"BAJO | MEDIO | ALTO"},"mensaje":{"type":"string","title":"Mensaje","description":"Mensaje de recomendación operativa"},"umbral_minimo":{"type":"number","title":"Umbral Minimo"},"umbral_maximo":{"type":"number","title":"Umbral Maximo"}},"type":"object","required":["codigo_saih","fecha_analisis","horizonte_dias","nivel_minimo_predicho","nivel_maximo_predicho","nivel_medio_predicho","prob_riesgo_bajo","prob_riesgo_alto","prob_riesgo_medio","categoria_riesgo","mensaje","umbral_minimo","umbral_maximo"],"title":"RiesgoEmbalse","description":"Evaluación de riesgo del embalse.","example":{"categoria_riesgo":"BAJO","codigo_saih":"E001","fecha_analisis":"2024-02-01","horizonte_dias":90,"mensaje":"Niveles estables dentro del rango seguro. Situación favorable.","nivel_maximo_predicho":315.8,"nivel_medio_predicho":308.2,"nivel_minimo_predicho":302.5,"prob_riesgo_alto":0.05,"prob_riesgo_bajo":0.15,"prob_riesgo_medio":0.8,"umbral_maximo":350.0,"umbral_minimo":300.0}},"RiesgoOrganismoDTO":{"properties":{"id_organismo":{"type":"integer","title":"Id Organismo","description":"ID del organismo"},"organismo":{"type":"string","title":"Organismo","description":"Nombre del organismo"},"tipo_gestion":{"type":"string","title":"Tipo Gestion","description":"Estatal o Autonómica"},"num_demarcaciones":{"type":"integer","title":"Num Demarcaciones","description":"Número de demarcaciones gestionadas"},"total_embalses":{"type":"integer","title":"Total Embalses","description":"Total de embalses bajo gestión"},"embalses_riesgo_alto":{"type":"integer","title":"Embalses Riesgo Alto","description":"Embalses con riesgo ALTO","default":0},"embalses_riesgo_moderado":{"type":"integer","title":"Embalses Riesgo Moderado","description":"Embalses con riesgo MODERADO","default":0},"embalses_riesgo_sequia":{"type":"integer","title":"Embalses Riesgo Sequia","description":"Embalses con riesgo SEQUÍA","default":0},"embalses_riesgo_bajo":{"type":"integer","title":"Embalses Riesgo Bajo","description":"Embalses con riesgo BAJO","default":0},"porcentaje_criticos":{"type":"number","title":"Porcentaje Criticos","description":"% de embalses críticos","default":0.0},"ultima_actualizacion":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Ultima Actualizacion","description":"Última actualización"},"demarcaciones":{"items":{"$ref":"#/components/schemas/RiesgoDemarcacionDTO"},"type":"array","title":"Demarcaciones","description":"Detalle por demarcaciones"}},"type":"object","required":["id_organismo","organismo","tipo_gestion","num_demarcaciones","total_embalses"],"title":"RiesgoOrganismoDTO","description":"Resumen de riesgos agregados por organismo gestor.","example":{"demarcaciones":[],"embalses_riesgo_alto":2,"embalses_riesgo_bajo":8,"embalses_riesgo_moderado":5,"embalses_riesgo_sequia":0,"id_organismo":1,"num_demarcaciones":1,"organismo":"Augas de Galicia","porcentaje_criticos":13.33,"tipo_gestion":"Autonómica","total_embalses":15,"ultima_actualizacion":"2024-12-14T10:30:00"}},"RiesgoRequest":{"properties":{"fecha_inicio":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Fecha Inicio","description":"Fecha de inicio (si no se proporciona, usa la última disponible)"},"horizonte_dias":{"type":"integer","maximum":180.0,"minimum":1.0,"title":"Horizonte Dias","description":"Horizonte de predicción en días","default":90},"umbral_minimo":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Umbral Minimo","description":"Umbral mínimo de nivel (msnm)"},"umbral_maximo":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Umbral Maximo","description":"Umbral máximo de nivel (msnm)"}},"type":"object","title":"RiesgoRequest","description":"Request para análisis de riesgo.","example":{"fecha_inicio":"2024-02-01","horizonte_dias":90,"umbral_maximo":350.0,"umbral_minimo":300.0}},"SerieHistoricaPunto":{"properties":{"fecha":{"type":"string","title":"Fecha","description":"Fecha en formato ISO (YYYY-MM-DD)"},"nivel":{"type":"number","title":"Nivel","description":"Nivel del embalse (msnm)"},"precipitacion":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Precipitacion","description":"Precipitación (mm)"},"temperatura":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Temperatura","description":"Temperatura (°C)"},"caudal_promedio":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Caudal Promedio","description":"Caudal promedio (m³/s)"}},"type":"object","required":["fecha","nivel"],"title":"SerieHistoricaPunto","description":"Punto de datos históricos.","example":{"caudal_promedio":14.69,"fecha":"2024-02-01","nivel":306.13,"precipitacion":5.2,"temperatura":8.4}},"TipoInforme":{"type":"string","enum":["diario","semanal"],"title":"TipoInforme","description":"Tipos de informes disponibles."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}